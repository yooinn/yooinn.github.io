<!DOCTYPE html>
<html>
  <head>
      
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Jiank</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="description" content="温故而知新"/>
<meta name="keywords" content="温故而知新"/>

<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
<link rel="shortcut icon" href="https://yooinn.github.io//favicon.ico">

<link rel="stylesheet" href="https://yooinn.github.io//styles/main.css">

<!-- Modernizr JS -->
<script src="https://yooinn.github.io/media/scripts/vendors/modernizr-2.6.2.min.js"></script>
<!-- FOR IE9 below -->
<!--[if lt IE 9]>
<scripts src="https://yooinn.github.io//media/scripts/_vendors/respond.min.js"></scripts>
<![endif]-->

<!-- Comment -->

    
        <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
    

    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/tomorrow-night.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<link crossorigin="anonymous" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" href="https://lib.baomitu.com/font-awesome/5.8.1/css/all.min.css" rel="stylesheet">

  </head>
  <body>
  
<div id="fh5co-offcanvas">
    <a href="#!" class="fh5co-close-offcanvas js-fh5co-close-offcanvas">
        <span><i class="icon-cross3"></i> <span>Close</span></span>
    </a>
    <div class="fh5co-bio">
        <figure>
            <img src="https://yooinn.github.io//media/images/avatar.png" alt="Jiank" class="img-responsive">
        </figure>
        <h3 class="heading">ABOUT ME</h3>
        <h2>Jiank</h2>
        <p>温故而知新</p>
        <ul class="fh5co-social">
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
        </ul>
    </div>

    <div class="fh5co-menu">
        <div class="fh5co-box">
            <h3 class="heading">搜索</h3>
            <form action="#">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="输入关键字">
                </div>
            </form>
        </div>
        <div class="fh5co-box">
            <h3 class="heading">标签</h3>
            <ul>
                
                    <li><a href="https://yooinn.github.io//tag/tXH4POF09">python</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/LIFaQWPrF">Centos</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/QRAqbdG_m">django</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/ewoty_xe6">CSRF</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/Mz5dw6SaJF">攻击</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/FuqRNjlSWx">爬虫</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/mgBwHqvScq">代理</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/wV8K1iN-L">sublime</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/FTcnjIO1M9">开发环境</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/slsqa3JFOO">加密</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/IL7UdZM90j">解密</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/HOyveGXQl">redis</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/b9SNjXwUQ6">缓存</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/zE5M8ZF1G">算法</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/8ds-G3FOk2">队列 消息 线程</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/QakZrWwK7">mysql</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/gridea">Gridea</a></li>
                
            </ul>
        </div>
    </div>
</div>

<header id="fh5co-header">
    <div class="container-fluid">
        <div class="row">
            <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
            <ul class="fh5co-social">
                
                    <li>
                        <a href="/"
                         >
                            首页
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives"
                         >
                            归档
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags"
                         >
                            标签
                        </a>
                    </li>
                
                    <li>
                        <a href="/post/about"
                         >
                            关于
                        </a>
                    </li>
                
            </ul>
            <div class="col-lg-12 col-md-12 text-center">
                <h1 id="fh5co-logo">
                    <a href="https://yooinn.github.io/">Jiank</a>
                </h1>
            </div>
        </div>
    </div>
</header>


<!--  <a href="#" class="fh5co-post-prev"><span>👈 Prev</span></a>-->
<!--  <a href="#" class="fh5co-post-next"><span>Next 👉</span></a>-->

  <div class="container-fluid">
      <div class="row fh5co-post-entry single-entry">
          <article class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 col-xs-12 col-xs-offset-0">
              <figure class="animate-box">
                  
              </figure>
              <span class="fh5co-meta animate-box">
                  
                      <div class="tag-container">
                          
                              <a href="https://yooinn.github.io//tag/QRAqbdG_m" class="tag">django, </a>
                          
                      </div>
                  
              </span>
              <h2 class="fh5co-article-title animate-box">django-simple-captcha 图形验证码模块</h2>
              <span class="fh5co-meta fh5co-date animate-box">2019-09-20</span>

              <div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-12 col-xs-offset-0 text-left content-article">
                  <div class="row">
                      <div class="col-md-12 animate-box post-content">
                          <p> <p>**一、引言 **<br>
        官方文档：django-simple-captcha</p>
<p>本博客谈不上深度，算是笔记和一些探索经验。主要是遇到了一个实际问题，在使用django-simple-captcha模块的时候，官网推荐使用django表单的形式去添加，django表单确实很方便，但是对于简单项目或者只需要django-simple-captcha模块的时候也没有太多的文档具体说明，这篇博客就说一下怎么单独使用django-simple-captcha模块。</p>
<p>目标：实现手动创建验证码和前端显示，后台手动验证，ajax请求。</p>
<p><strong>二、流程</strong><br>
1）安装 django-simple-captcha</p>
<p>pip install django-simple-captcha<br>
2）注册captcha</p>
<p>INSTALLED_APPS = [<br>
'django.contrib.admin',<br>
'django.contrib.auth',<br>
'django.contrib.contenttypes',<br>
'django.contrib.sessions',<br>
'django.contrib.messages',<br>
'django.contrib.staticfiles',<br>
'captcha',<br>
]<br>
也可以个性化定制，在 settings.py中添加如下代码，详情参考官方文档：</p>
<h1 id="设置-captcha-图片大小">设置 captcha 图片大小</h1>
<p>CAPTCHA_IMAGE_SIZE = (80, 45)</p>
<h1 id="字符个数">字符个数</h1>
<p>CAPTCHA_LENGTH = 4</p>
<h1 id="超时minutes">超时(minutes)</h1>
<p>CAPTCHA_TIMEOUT = 1<br>
3）执行数据迁移，生成数据表 captcha_captchastore</p>
<p>python manage.py migrate<br>
4）添加路由</p>
<p>urlpatterns = [<br>
path('admin/', admin.site.urls),<br>
# 图片验证码 路由<br>
path('captcha/', include('captcha.urls'))<br>
]<br>
再添加ajax刷新请求的二级路由，ajxa请求地址： /refresh_captcha/</p>
<p>path('refresh_captcha/', views.refresh_captcha),    # 刷新验证码，ajax<br>
本次django使用的是2.1.8版本，路由的写法可能有点不同，原理一样。</p>
<p>5）在views.py中添加代码，因为在我的项目中，设计到代码的复用问题，所以我创建验证码和验证单独做成函数</p>
<pre><code> 验证码需要导入的模块
from captcha.models import CaptchaStore
from captcha.helpers import captcha_image_url
from django.http import JsonResponse
 
# 创建验证码
def captcha():
    # 验证码，第一次请求
    hashkey = CaptchaStore.generate_key()
    image_url = captcha_image_url(hashkey)
    captcha = {'hashkey': hashkey, 'image_url': image_url}
    return captcha
		
 #验证码API接口
def refresh_captcha(request):
    # 响应
    return JsonResponse(captcha(), content_type='application/json')
 
# 验证验证码
def jarge_captcha(captchaStr, captchaHashkey):
    if captchaStr and captchaHashkey:
        try:
            # 获取根据hashkey获取数据库中的response值
            get_captcha = CaptchaStore.objects.get(hashkey=captchaHashkey) 
            # 如果验证码匹配
            if get_captcha.response == captchaStr.lower():  
                return True
        except:
            return False
    else:
        return False
</code></pre>
<p><strong>前端页面：</strong></p>
<pre><code>&lt;div class=&quot;form-group&quot;&gt;
    &lt;label for=&quot;id_password&quot;&gt;验证码&lt;/label&gt;
    &lt;div id=&quot;captcha_div&quot;&gt;
        &lt;input type=&quot;text&quot; name='captcha' class=&quot;form-control&quot; placeholder=&quot;Captcha&quot; required style=&quot;width: 55%;display: inline-block;margin-right: 8%;&quot;&gt;
        &lt;a href=&quot;#&quot; class=&quot;captcha&quot;&gt;&lt;img src=&quot;{{captcha.image_url}}&quot; alt=&quot;点击换一张&quot; id=&quot;id_captcha&quot;&gt;&lt;/a&gt;
        &lt;input value=&quot;{{captcha.hashkey}}&quot; name=&quot;hashkey&quot; type=&quot;hidden&quot; id=&quot;id_captcha_0&quot;&gt;
    &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p><strong>前端页面显示图片采用 src=&quot;{{captcha.image_url}}&quot;来获取：</strong></p>
<pre><code>&lt;script&gt;
        &lt;!-- 动态刷新验证码js --&gt;
        //网页加载时调用
        $(document).ready(function(){
            //网页加载时发送请求
            $.getJSON(&quot;/refresh_captcha/&quot;, function (result) {
                    $('#id_captcha').attr('src', result['image_url']);
                    $('#id_captcha_0').val(result['hashkey'])
                });
            //点击按钮触发,发送请求
            $('.captcha').click(function () {
                $.getJSON(&quot;/refresh_captcha/&quot;, function (result) {
                    $('#id_captcha').attr('src', result['image_url']);
                    $('#id_captcha_0').val(result['hashkey'])
                });
            });
        });
&lt;/script&gt;
</code></pre>
<p>效果<br>
<img src="https://i.loli.net/2019/09/20/9OueNLHPFosdRyr.png" alt=""></p>
 </p>
                      </div>
                  </div>

                  <div class="row">
                      <div class="col-md-12 animate-box">
                          
                              <div class="next-post">
                                  <div class="next">下一篇</div>
                                  <a href="https://yooinn.github.io//post/django-templates-mo-ban-de-yu-fa">
                                      <h3 class="post-title">
                                          Django templates 模板的语法
                                      </h3>
                                  </a>
                              </div>
                          
                      </div>
                  </div>

                  <div class="row">
                      <div class="col-md-12 animate-box">
                          
                              
                                  <div id="gitalk-container"></div>
                              

                              
                          
                      </div>
                  </div>
              </div>

          </article>
      </div>
  </div>

    
<footer id="fh5co-footer">
  <p>Powered by <a href="https://yooinn.github.io/" target="_blank">Jiank</a></p>
</footer>


    
<!-- jQuery -->
<script src="https://yooinn.github.io//media/scripts/vendors/jquery.min.js"></script>
<!-- jQuery Easing -->
<script src="https://yooinn.github.io//media/scripts/vendors/jquery.easing.1.3.js"></script>
<!-- Bootstrap -->
<script src="https://yooinn.github.io//media/scripts/vendors/bootstrap.min.js"></script>
<!-- Waypoints -->
<script src="https://yooinn.github.io//media/scripts/vendors/jquery.waypoints.min.js"></script>
<!-- Main JS -->
<script src="https://yooinn.github.io//media/scripts/vendors/main.js"></script>
<!-- Md5 Min JS -->
<script src="https://yooinn.github.io//media/scripts/vendors/md5.min.js"></script>

<script type="application/javascript">
    hljs.initHighlightingOnLoad();
</script>



    
        <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
        <script>

            var gitalk = new Gitalk({
                clientID: '18da3e757583aa6301c0',
                clientSecret: '49cea6508bf61d7606bce51766288ea312bd7456',
                repo: 'yooinn.github.io',
                owner: 'yooinn',
                admin: ['yooinn'],
                id: md5(location.pathname),      // Ensure uniqueness and length less than 50
                distractionFreeMode: false  // Facebook-like distraction free mode
            })

            gitalk.render('gitalk-container')

        </script>
    

    




  </body>
</html>
