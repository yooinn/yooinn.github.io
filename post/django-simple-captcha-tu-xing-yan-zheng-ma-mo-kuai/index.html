<!DOCTYPE html>
<html>
  <head>
      
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Jiank</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="description" content="æ¸©æ•…è€ŒçŸ¥æ–°"/>
<meta name="keywords" content="æ¸©æ•…è€ŒçŸ¥æ–°"/>

<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
<link rel="shortcut icon" href="https://yooinn.github.io//favicon.ico">

<link rel="stylesheet" href="https://yooinn.github.io//styles/main.css">

<!-- Modernizr JS -->
<script src="https://yooinn.github.io/media/scripts/vendors/modernizr-2.6.2.min.js"></script>
<!-- FOR IE9 below -->
<!--[if lt IE 9]>
<scripts src="https://yooinn.github.io//media/scripts/_vendors/respond.min.js"></scripts>
<![endif]-->

<!-- Comment -->

    
        <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
    

    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/tomorrow-night.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<link crossorigin="anonymous" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" href="https://lib.baomitu.com/font-awesome/5.8.1/css/all.min.css" rel="stylesheet">

  </head>
  <body>
  
<div id="fh5co-offcanvas">
    <a href="#!" class="fh5co-close-offcanvas js-fh5co-close-offcanvas">
        <span><i class="icon-cross3"></i> <span>Close</span></span>
    </a>
    <div class="fh5co-bio">
        <figure>
            <img src="https://yooinn.github.io//media/images/avatar.png" alt="Jiank" class="img-responsive">
        </figure>
        <h3 class="heading">ABOUT ME</h3>
        <h2>Jiank</h2>
        <p>æ¸©æ•…è€ŒçŸ¥æ–°</p>
        <ul class="fh5co-social">
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
        </ul>
    </div>

    <div class="fh5co-menu">
        <div class="fh5co-box">
            <h3 class="heading">æœç´¢</h3>
            <form action="#">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="è¾“å…¥å…³é”®å­—">
                </div>
            </form>
        </div>
        <div class="fh5co-box">
            <h3 class="heading">æ ‡ç­¾</h3>
            <ul>
                
                    <li><a href="https://yooinn.github.io//tag/tXH4POF09">python</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/LIFaQWPrF">Centos</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/QRAqbdG_m">django</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/ewoty_xe6">CSRF</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/Mz5dw6SaJF">æ”»å‡»</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/FuqRNjlSWx">çˆ¬è™«</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/mgBwHqvScq">ä»£ç†</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/wV8K1iN-L">sublime</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/FTcnjIO1M9">å¼€å‘ç¯å¢ƒ</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/slsqa3JFOO">åŠ å¯†</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/IL7UdZM90j">è§£å¯†</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/HOyveGXQl">redis</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/b9SNjXwUQ6">ç¼“å­˜</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/zE5M8ZF1G">ç®—æ³•</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/8ds-G3FOk2">é˜Ÿåˆ— æ¶ˆæ¯ çº¿ç¨‹</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/QakZrWwK7">mysql</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/gridea">Gridea</a></li>
                
            </ul>
        </div>
    </div>
</div>

<header id="fh5co-header">
    <div class="container-fluid">
        <div class="row">
            <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
            <ul class="fh5co-social">
                
                    <li>
                        <a href="/"
                         >
                            é¦–é¡µ
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives"
                         >
                            å½’æ¡£
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags"
                         >
                            æ ‡ç­¾
                        </a>
                    </li>
                
                    <li>
                        <a href="/post/about"
                         >
                            å…³äº
                        </a>
                    </li>
                
            </ul>
            <div class="col-lg-12 col-md-12 text-center">
                <h1 id="fh5co-logo">
                    <a href="https://yooinn.github.io/">Jiank</a>
                </h1>
            </div>
        </div>
    </div>
</header>


<!--  <a href="#" class="fh5co-post-prev"><span>ğŸ‘ˆ Prev</span></a>-->
<!--  <a href="#" class="fh5co-post-next"><span>Next ğŸ‘‰</span></a>-->

  <div class="container-fluid">
      <div class="row fh5co-post-entry single-entry">
          <article class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 col-xs-12 col-xs-offset-0">
              <figure class="animate-box">
                  
              </figure>
              <span class="fh5co-meta animate-box">
                  
                      <div class="tag-container">
                          
                              <a href="https://yooinn.github.io//tag/QRAqbdG_m" class="tag">django, </a>
                          
                      </div>
                  
              </span>
              <h2 class="fh5co-article-title animate-box">django-simple-captcha å›¾å½¢éªŒè¯ç æ¨¡å—</h2>
              <span class="fh5co-meta fh5co-date animate-box">2019-09-20</span>

              <div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-12 col-xs-offset-0 text-left content-article">
                  <div class="row">
                      <div class="col-md-12 animate-box post-content">
                          <p> <p>**ä¸€ã€å¼•è¨€Â **<br>
Â  Â  Â  Â  å®˜æ–¹æ–‡æ¡£ï¼šdjango-simple-captcha</p>
<p>æœ¬åšå®¢è°ˆä¸ä¸Šæ·±åº¦ï¼Œç®—æ˜¯ç¬”è®°å’Œä¸€äº›æ¢ç´¢ç»éªŒã€‚ä¸»è¦æ˜¯é‡åˆ°äº†ä¸€ä¸ªå®é™…é—®é¢˜ï¼Œåœ¨ä½¿ç”¨django-simple-captchaæ¨¡å—çš„æ—¶å€™ï¼Œå®˜ç½‘æ¨èä½¿ç”¨djangoè¡¨å•çš„å½¢å¼å»æ·»åŠ ï¼Œdjangoè¡¨å•ç¡®å®å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯å¯¹äºç®€å•é¡¹ç›®æˆ–è€…åªéœ€è¦django-simple-captchaæ¨¡å—çš„æ—¶å€™ä¹Ÿæ²¡æœ‰å¤ªå¤šçš„æ–‡æ¡£å…·ä½“è¯´æ˜ï¼Œè¿™ç¯‡åšå®¢å°±è¯´ä¸€ä¸‹æ€ä¹ˆå•ç‹¬ä½¿ç”¨django-simple-captchaæ¨¡å—ã€‚</p>
<p>ç›®æ ‡ï¼šå®ç°æ‰‹åŠ¨åˆ›å»ºéªŒè¯ç å’Œå‰ç«¯æ˜¾ç¤ºï¼Œåå°æ‰‹åŠ¨éªŒè¯ï¼Œajaxè¯·æ±‚ã€‚</p>
<p><strong>äºŒã€æµç¨‹</strong><br>
1ï¼‰å®‰è£… django-simple-captcha</p>
<p>pip install django-simple-captcha<br>
2ï¼‰æ³¨å†Œcaptcha</p>
<p>INSTALLED_APPS = [<br>
'django.contrib.admin',<br>
'django.contrib.auth',<br>
'django.contrib.contenttypes',<br>
'django.contrib.sessions',<br>
'django.contrib.messages',<br>
'django.contrib.staticfiles',<br>
'captcha',<br>
]<br>
ä¹Ÿå¯ä»¥ä¸ªæ€§åŒ–å®šåˆ¶ï¼Œåœ¨ settings.pyä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œè¯¦æƒ…å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š</p>
<h1 id="è®¾ç½®-captcha-å›¾ç‰‡å¤§å°">è®¾ç½® captcha å›¾ç‰‡å¤§å°</h1>
<p>CAPTCHA_IMAGE_SIZE = (80, 45)</p>
<h1 id="å­—ç¬¦ä¸ªæ•°">å­—ç¬¦ä¸ªæ•°</h1>
<p>CAPTCHA_LENGTH = 4</p>
<h1 id="è¶…æ—¶minutes">è¶…æ—¶(minutes)</h1>
<p>CAPTCHA_TIMEOUT = 1<br>
3ï¼‰æ‰§è¡Œæ•°æ®è¿ç§»ï¼Œç”Ÿæˆæ•°æ®è¡¨Â captcha_captchastore</p>
<p>python manage.py migrate<br>
4ï¼‰æ·»åŠ è·¯ç”±</p>
<p>urlpatterns = [<br>
path('admin/', admin.site.urls),<br>
# å›¾ç‰‡éªŒè¯ç  è·¯ç”±<br>
path('captcha/', include('captcha.urls'))<br>
]<br>
å†æ·»åŠ ajaxåˆ·æ–°è¯·æ±‚çš„äºŒçº§è·¯ç”±ï¼Œajxaè¯·æ±‚åœ°å€ï¼š /refresh_captcha/</p>
<p>path('refresh_captcha/', views.refresh_captcha),    # åˆ·æ–°éªŒè¯ç ï¼Œajax<br>
æœ¬æ¬¡djangoä½¿ç”¨çš„æ˜¯2.1.8ç‰ˆæœ¬ï¼Œè·¯ç”±çš„å†™æ³•å¯èƒ½æœ‰ç‚¹ä¸åŒï¼ŒåŸç†ä¸€æ ·ã€‚</p>
<p>5ï¼‰åœ¨views.pyä¸­æ·»åŠ ä»£ç ï¼Œå› ä¸ºåœ¨æˆ‘çš„é¡¹ç›®ä¸­ï¼Œè®¾è®¡åˆ°ä»£ç çš„å¤ç”¨é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘åˆ›å»ºéªŒè¯ç å’ŒéªŒè¯å•ç‹¬åšæˆå‡½æ•°</p>
<pre><code> éªŒè¯ç éœ€è¦å¯¼å…¥çš„æ¨¡å—
from captcha.models import CaptchaStore
from captcha.helpers import captcha_image_url
from django.http import JsonResponse
 
# åˆ›å»ºéªŒè¯ç 
def captcha():
    # éªŒè¯ç ï¼Œç¬¬ä¸€æ¬¡è¯·æ±‚
    hashkey = CaptchaStore.generate_key()
    image_url = captcha_image_url(hashkey)
    captcha = {'hashkey': hashkey, 'image_url': image_url}
    return captcha
		
 #éªŒè¯ç APIæ¥å£
def refresh_captcha(request):
    # å“åº”
    return JsonResponse(captcha(), content_type='application/json')
 
# éªŒè¯éªŒè¯ç 
def jarge_captcha(captchaStr, captchaHashkey):
    if captchaStr and captchaHashkey:
        try:
            # è·å–æ ¹æ®hashkeyè·å–æ•°æ®åº“ä¸­çš„responseå€¼
            get_captcha = CaptchaStore.objects.get(hashkey=captchaHashkey) 
            # å¦‚æœéªŒè¯ç åŒ¹é…
            if get_captcha.response == captchaStr.lower():  
                return True
        except:
            return False
    else:
        return False
</code></pre>
<p><strong>å‰ç«¯é¡µé¢ï¼š</strong></p>
<pre><code>&lt;div class=&quot;form-group&quot;&gt;
    &lt;label for=&quot;id_password&quot;&gt;éªŒè¯ç &lt;/label&gt;
    &lt;div id=&quot;captcha_div&quot;&gt;
        &lt;input type=&quot;text&quot; name='captcha' class=&quot;form-control&quot; placeholder=&quot;Captcha&quot; required style=&quot;width: 55%;display: inline-block;margin-right: 8%;&quot;&gt;
        &lt;a href=&quot;#&quot; class=&quot;captcha&quot;&gt;&lt;img src=&quot;{{captcha.image_url}}&quot; alt=&quot;ç‚¹å‡»æ¢ä¸€å¼ &quot; id=&quot;id_captcha&quot;&gt;&lt;/a&gt;
        &lt;input value=&quot;{{captcha.hashkey}}&quot; name=&quot;hashkey&quot; type=&quot;hidden&quot; id=&quot;id_captcha_0&quot;&gt;
    &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p><strong>å‰ç«¯é¡µé¢æ˜¾ç¤ºå›¾ç‰‡é‡‡ç”¨ src=&quot;{{captcha.image_url}}&quot;æ¥è·å–ï¼š</strong></p>
<pre><code>&lt;script&gt;
        &lt;!-- åŠ¨æ€åˆ·æ–°éªŒè¯ç js --&gt;
        //ç½‘é¡µåŠ è½½æ—¶è°ƒç”¨
        $(document).ready(function(){
            //ç½‘é¡µåŠ è½½æ—¶å‘é€è¯·æ±‚
            $.getJSON(&quot;/refresh_captcha/&quot;, function (result) {
                    $('#id_captcha').attr('src', result['image_url']);
                    $('#id_captcha_0').val(result['hashkey'])
                });
            //ç‚¹å‡»æŒ‰é’®è§¦å‘,å‘é€è¯·æ±‚
            $('.captcha').click(function () {
                $.getJSON(&quot;/refresh_captcha/&quot;, function (result) {
                    $('#id_captcha').attr('src', result['image_url']);
                    $('#id_captcha_0').val(result['hashkey'])
                });
            });
        });
&lt;/script&gt;
</code></pre>
<p>æ•ˆæœ<br>
<img src="https://i.loli.net/2019/09/20/9OueNLHPFosdRyr.png" alt=""></p>
 </p>
                      </div>
                  </div>

                  <div class="row">
                      <div class="col-md-12 animate-box">
                          
                              <div class="next-post">
                                  <div class="next">ä¸‹ä¸€ç¯‡</div>
                                  <a href="https://yooinn.github.io//post/django-templates-mo-ban-de-yu-fa">
                                      <h3 class="post-title">
                                          Django templates æ¨¡æ¿çš„è¯­æ³•
                                      </h3>
                                  </a>
                              </div>
                          
                      </div>
                  </div>

                  <div class="row">
                      <div class="col-md-12 animate-box">
                          
                              
                                  <div id="gitalk-container"></div>
                              

                              
                          
                      </div>
                  </div>
              </div>

          </article>
      </div>
  </div>

    
<footer id="fh5co-footer">
  <p>Powered by <a href="https://yooinn.github.io/" target="_blank">Jiank</a></p>
</footer>


    
<!-- jQuery -->
<script src="https://yooinn.github.io//media/scripts/vendors/jquery.min.js"></script>
<!-- jQuery Easing -->
<script src="https://yooinn.github.io//media/scripts/vendors/jquery.easing.1.3.js"></script>
<!-- Bootstrap -->
<script src="https://yooinn.github.io//media/scripts/vendors/bootstrap.min.js"></script>
<!-- Waypoints -->
<script src="https://yooinn.github.io//media/scripts/vendors/jquery.waypoints.min.js"></script>
<!-- Main JS -->
<script src="https://yooinn.github.io//media/scripts/vendors/main.js"></script>
<!-- Md5 Min JS -->
<script src="https://yooinn.github.io//media/scripts/vendors/md5.min.js"></script>

<script type="application/javascript">
    hljs.initHighlightingOnLoad();
</script>



    
        <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
        <script>

            var gitalk = new Gitalk({
                clientID: '18da3e757583aa6301c0',
                clientSecret: '49cea6508bf61d7606bce51766288ea312bd7456',
                repo: 'yooinn.github.io',
                owner: 'yooinn',
                admin: ['yooinn'],
                id: md5(location.pathname),      // Ensure uniqueness and length less than 50
                distractionFreeMode: false  // Facebook-like distraction free mode
            })

            gitalk.render('gitalk-container')

        </script>
    

    




  </body>
</html>
