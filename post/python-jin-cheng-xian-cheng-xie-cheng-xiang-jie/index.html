<!DOCTYPE html>
<html>
  <head>
      
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Jiank</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="description" content="æ¸©æ•…è€ŒçŸ¥æ–°"/>
<meta name="keywords" content="æ¸©æ•…è€ŒçŸ¥æ–°"/>

<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
<link rel="shortcut icon" href="https://yooinn.github.io//favicon.ico">

<link rel="stylesheet" href="https://yooinn.github.io//styles/main.css">

<!-- Modernizr JS -->
<script src="https://yooinn.github.io/media/scripts/vendors/modernizr-2.6.2.min.js"></script>
<!-- FOR IE9 below -->
<!--[if lt IE 9]>
<scripts src="https://yooinn.github.io//media/scripts/_vendors/respond.min.js"></scripts>
<![endif]-->

<!-- Comment -->

    
        <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
    

    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/tomorrow-night.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<link crossorigin="anonymous" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" href="https://lib.baomitu.com/font-awesome/5.8.1/css/all.min.css" rel="stylesheet">

  </head>
  <body>
  
<div id="fh5co-offcanvas">
    <a href="#!" class="fh5co-close-offcanvas js-fh5co-close-offcanvas">
        <span><i class="icon-cross3"></i> <span>Close</span></span>
    </a>
    <div class="fh5co-bio">
        <figure>
            <img src="https://yooinn.github.io//media/images/avatar.png" alt="Jiank" class="img-responsive">
        </figure>
        <h3 class="heading">ABOUT ME</h3>
        <h2>Jiank</h2>
        <p>æ¸©æ•…è€ŒçŸ¥æ–°</p>
        <ul class="fh5co-social">
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
        </ul>
    </div>

    <div class="fh5co-menu">
        <div class="fh5co-box">
            <h3 class="heading">æœç´¢</h3>
            <form action="#">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="è¾“å…¥å…³é”®å­—">
                </div>
            </form>
        </div>
        <div class="fh5co-box">
            <h3 class="heading">æ ‡ç­¾</h3>
            <ul>
                
                    <li><a href="https://yooinn.github.io//tag/jj-MVXJyc">mongodb</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/FuqRNjlSWx">çˆ¬è™«</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/tXH4POF09">python</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/LIFaQWPrF">Centos</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/QRAqbdG_m">django</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/ewoty_xe6">CSRF</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/Mz5dw6SaJF">æ”»å‡»</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/mgBwHqvScq">ä»£ç†</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/wV8K1iN-L">sublime</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/FTcnjIO1M9">å¼€å‘ç¯å¢ƒ</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/slsqa3JFOO">åŠ å¯†</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/IL7UdZM90j">è§£å¯†</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/HOyveGXQl">redis</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/b9SNjXwUQ6">ç¼“å­˜</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/zE5M8ZF1G">ç®—æ³•</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/8ds-G3FOk2">é˜Ÿåˆ— æ¶ˆæ¯ çº¿ç¨‹</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/QakZrWwK7">mysql</a></li>
                
                    <li><a href="https://yooinn.github.io//tag/gridea">Gridea</a></li>
                
            </ul>
        </div>
    </div>
</div>

<header id="fh5co-header">
    <div class="container-fluid">
        <div class="row">
            <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
            <ul class="fh5co-social">
                
                    <li>
                        <a href="/"
                         >
                            é¦–é¡µ
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives"
                         >
                            å½’æ¡£
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags"
                         >
                            æ ‡ç­¾
                        </a>
                    </li>
                
                    <li>
                        <a href="/post/about"
                         >
                            å…³äº
                        </a>
                    </li>
                
            </ul>
            <div class="col-lg-12 col-md-12 text-center">
                <h1 id="fh5co-logo">
                    <a href="https://yooinn.github.io/">Jiank</a>
                </h1>
            </div>
        </div>
    </div>
</header>


<!--  <a href="#" class="fh5co-post-prev"><span>ğŸ‘ˆ Prev</span></a>-->
<!--  <a href="#" class="fh5co-post-next"><span>Next ğŸ‘‰</span></a>-->

  <div class="container-fluid">
      <div class="row fh5co-post-entry single-entry">
          <article class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 col-xs-12 col-xs-offset-0">
              <figure class="animate-box">
                  
              </figure>
              <span class="fh5co-meta animate-box">
                  
                      <div class="tag-container">
                          
                              <a href="https://yooinn.github.io//tag/tXH4POF09" class="tag">python, </a>
                          
                      </div>
                  
              </span>
              <h2 class="fh5co-article-title animate-box">Pythonè¿›ç¨‹ã€çº¿ç¨‹ã€åç¨‹è¯¦è§£</h2>
              <span class="fh5co-meta fh5co-date animate-box">2019-09-19</span>

              <div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-12 col-xs-offset-0 text-left content-article">
                  <div class="row">
                      <div class="col-md-12 animate-box post-content">
                          <p> <p>è¿›ç¨‹ä¸çº¿ç¨‹çš„å†å²<br>
æˆ‘ä»¬éƒ½çŸ¥é“è®¡ç®—æœºæ˜¯ç”±ç¡¬ä»¶å’Œè½¯ä»¶ç»„æˆçš„ã€‚ç¡¬ä»¶ä¸­çš„CPUæ˜¯è®¡ç®—æœºçš„æ ¸å¿ƒï¼Œå®ƒæ‰¿æ‹…è®¡ç®—æœºçš„æ‰€æœ‰ä»»åŠ¡ã€‚ æ“ä½œç³»ç»Ÿæ˜¯è¿è¡Œåœ¨ç¡¬ä»¶ä¹‹ä¸Šçš„è½¯ä»¶ï¼Œæ˜¯è®¡ç®—æœºçš„ç®¡ç†è€…ï¼Œå®ƒè´Ÿè´£èµ„æºçš„ç®¡ç†å’Œåˆ†é…ã€ä»»åŠ¡çš„è°ƒåº¦ã€‚ ç¨‹åºæ˜¯è¿è¡Œåœ¨ç³»ç»Ÿä¸Šçš„å…·æœ‰æŸç§åŠŸèƒ½çš„è½¯ä»¶ï¼Œæ¯”å¦‚è¯´æµè§ˆå™¨ï¼ŒéŸ³ä¹æ’­æ”¾å™¨ç­‰ã€‚ æ¯æ¬¡æ‰§è¡Œç¨‹åºçš„æ—¶å€™ï¼Œéƒ½ä¼šå®Œæˆä¸€å®šçš„åŠŸèƒ½ï¼Œæ¯”å¦‚è¯´æµè§ˆå™¨å¸®æˆ‘ä»¬æ‰“å¼€ç½‘é¡µï¼Œä¸ºäº†ä¿è¯å…¶ç‹¬ç«‹æ€§ï¼Œå°±éœ€è¦ä¸€ä¸ªä¸“é—¨çš„ç®¡ç†å’Œæ§åˆ¶æ‰§è¡Œç¨‹åºçš„æ•°æ®ç»“æ„â€”â€”è¿›ç¨‹æ§åˆ¶å—ã€‚ è¿›ç¨‹å°±æ˜¯ä¸€ä¸ªç¨‹åºåœ¨ä¸€ä¸ªæ•°æ®é›†ä¸Šçš„ä¸€æ¬¡åŠ¨æ€æ‰§è¡Œè¿‡ç¨‹ã€‚ è¿›ç¨‹ä¸€èˆ¬ç”±ç¨‹åºã€æ•°æ®é›†ã€è¿›ç¨‹æ§åˆ¶å—ä¸‰éƒ¨åˆ†ç»„æˆã€‚æˆ‘ä»¬ç¼–å†™çš„ç¨‹åºç”¨æ¥æè¿°è¿›ç¨‹è¦å®Œæˆå“ªäº›åŠŸèƒ½ä»¥åŠå¦‚ä½•å®Œæˆï¼›æ•°æ®é›†åˆ™æ˜¯ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€éœ€è¦ä½¿ç”¨çš„èµ„æºï¼›è¿›ç¨‹æ§åˆ¶å—ç”¨æ¥è®°å½•è¿›ç¨‹çš„å¤–éƒ¨ç‰¹å¾ï¼Œæè¿°è¿›ç¨‹çš„æ‰§è¡Œå˜åŒ–è¿‡ç¨‹ï¼Œç³»ç»Ÿå¯ä»¥åˆ©ç”¨å®ƒæ¥æ§åˆ¶å’Œç®¡ç†è¿›ç¨‹ï¼Œå®ƒæ˜¯ç³»ç»Ÿæ„ŸçŸ¥è¿›ç¨‹å­˜åœ¨çš„å”¯ä¸€æ ‡å¿—ã€‚</p>
<p>åœ¨æ—©æœŸçš„æ“ä½œç³»ç»Ÿé‡Œï¼Œè®¡ç®—æœºåªæœ‰ä¸€ä¸ªæ ¸å¿ƒï¼Œè¿›ç¨‹æ‰§è¡Œç¨‹åºçš„æœ€å°å•ä½ï¼Œä»»åŠ¡è°ƒåº¦é‡‡ç”¨æ—¶é—´ç‰‡è½®è½¬çš„æŠ¢å å¼æ–¹å¼è¿›è¡Œè¿›ç¨‹è°ƒåº¦ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰å„è‡ªçš„ä¸€å—ç‹¬ç«‹çš„å†…å­˜ï¼Œä¿è¯è¿›ç¨‹å½¼æ­¤é—´çš„å†…å­˜åœ°å€ç©ºé—´çš„éš”ç¦»ã€‚ éšç€è®¡ç®—æœºæŠ€æœ¯çš„å‘å±•ï¼Œè¿›ç¨‹å‡ºç°äº†å¾ˆå¤šå¼Šç«¯ï¼Œä¸€æ˜¯è¿›ç¨‹çš„åˆ›å»ºã€æ’¤é”€å’Œåˆ‡æ¢çš„å¼€é”€æ¯”è¾ƒå¤§ï¼ŒäºŒæ˜¯ç”±äºå¯¹ç§°å¤šå¤„ç†æœºï¼ˆå¯¹ç§°å¤šå¤„ç†æœºï¼ˆSymmetricalMulti-Processingï¼‰åˆå«SMPï¼Œæ˜¯æŒ‡åœ¨ä¸€ä¸ªè®¡ç®—æœºä¸Šæ±‡é›†äº†ä¸€ç»„å¤„ç†å™¨(å¤šCPU)ï¼Œå„CPUä¹‹é—´å…±äº«å†…å­˜å­ç³»ç»Ÿä»¥åŠæ€»çº¿ç»“æ„ï¼‰çš„å‡ºç°ï¼Œå¯ä»¥æ»¡è¶³å¤šä¸ªè¿è¡Œå•ä½ï¼Œè€Œå¤šè¿›ç¨‹å¹¶è¡Œå¼€é”€è¿‡å¤§ã€‚ è¿™ä¸ªæ—¶å€™å°±å¼•å…¥äº†çº¿ç¨‹çš„æ¦‚å¿µã€‚ çº¿ç¨‹ä¹Ÿå«è½»é‡çº§è¿›ç¨‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºæœ¬çš„CPUæ‰§è¡Œå•å…ƒï¼Œä¹Ÿæ˜¯ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„æœ€å°å•å…ƒï¼Œç”±çº¿ç¨‹IDã€ç¨‹åºè®¡æ•°å™¨ã€å¯„å­˜å™¨é›†åˆ å’Œå †æ ˆå…±åŒç»„æˆã€‚çº¿ç¨‹çš„å¼•å…¥å‡å°äº†ç¨‹åºå¹¶å‘æ‰§è¡Œæ—¶çš„å¼€é”€ï¼Œæé«˜äº†æ“ä½œç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ã€‚ çº¿ç¨‹æ²¡æœ‰è‡ªå·±çš„ç³»ç»Ÿèµ„æºï¼Œåªæ‹¥æœ‰åœ¨è¿è¡Œæ—¶å¿…ä¸å¯å°‘çš„èµ„æºã€‚ä½†çº¿ç¨‹å¯ä»¥ä¸åŒå±ä¸åŒä¸€è¿›ç¨‹çš„å…¶ä»–çº¿ç¨‹å…±äº«è¿›ç¨‹æ‰€æ‹¥æœ‰çš„å…¶ä»–èµ„æºã€‚</p>
<p>è¿›ç¨‹ä¸çº¿ç¨‹ä¹‹é—´çš„å…³ç³»<br>
çº¿ç¨‹æ˜¯å±äºè¿›ç¨‹çš„ï¼Œçº¿ç¨‹è¿è¡Œåœ¨è¿›ç¨‹ç©ºé—´å†…ï¼ŒåŒä¸€è¿›ç¨‹æ‰€äº§ç”Ÿçš„çº¿ç¨‹å…±äº«åŒä¸€å†…å­˜ç©ºé—´ï¼Œå½“è¿›ç¨‹é€€å‡ºæ—¶è¯¥è¿›ç¨‹æ‰€äº§ç”Ÿçš„çº¿ç¨‹éƒ½ä¼šè¢«å¼ºåˆ¶é€€å‡ºå¹¶æ¸…é™¤ã€‚çº¿ç¨‹å¯ä¸å±äºåŒä¸€è¿›ç¨‹çš„å…¶å®ƒçº¿ç¨‹å…±äº«è¿›ç¨‹æ‰€æ‹¥æœ‰çš„å…¨éƒ¨èµ„æºï¼Œä½†æ˜¯å…¶æœ¬èº«åŸºæœ¬ä¸Šä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æºï¼Œåªæ‹¥æœ‰ä¸€ç‚¹åœ¨è¿è¡Œä¸­å¿…ä¸å¯å°‘çš„ä¿¡æ¯(å¦‚ç¨‹åºè®¡æ•°å™¨ã€ä¸€ç»„å¯„å­˜å™¨å’Œæ ˆ)ã€‚</p>
<p><strong>python çº¿ç¨‹</strong></p>
<p>Threadingç”¨äºæä¾›çº¿ç¨‹ç›¸å…³çš„æ“ä½œï¼Œçº¿ç¨‹æ˜¯åº”ç”¨ç¨‹åºä¸­å·¥ä½œçš„æœ€å°å•å…ƒã€‚</p>
<p><strong>1ã€threadingæ¨¡å—</strong><br>
threading æ¨¡å—å»ºç«‹åœ¨ _thread æ¨¡å—ä¹‹ä¸Šã€‚thread æ¨¡å—ä»¥ä½çº§ã€åŸå§‹çš„æ–¹å¼æ¥å¤„ç†å’Œæ§åˆ¶çº¿ç¨‹ï¼Œè€Œ threading æ¨¡å—é€šè¿‡å¯¹ thread è¿›è¡ŒäºŒæ¬¡å°è£…ï¼Œæä¾›äº†æ›´æ–¹ä¾¿çš„ api æ¥å¤„ç†çº¿ç¨‹ã€‚</p>
<pre><code>
import threading
import time
   
def worker(num):
    &quot;&quot;&quot;
    thread worker function
    :return:
    &quot;&quot;&quot;
    time.sleep(1)
    print(&quot;The num is  %d&quot; % num)
    return
   
for i in range(20):
    t = threading.Thread(target=worker,args=(i,)ï¼Œname=â€œt.%dâ€ % i)
    t.start()
</code></pre>
<p>ä¸Šè¿°ä»£ç åˆ›å»ºäº†20ä¸ªâ€œå‰å°â€çº¿ç¨‹ï¼Œç„¶åæ§åˆ¶å™¨å°±äº¤ç»™äº†CPUï¼ŒCPUæ ¹æ®æŒ‡å®šç®—æ³•è¿›è¡Œè°ƒåº¦ï¼Œåˆ†ç‰‡æ‰§è¡ŒæŒ‡ä»¤ã€‚</p>
<p>Threadæ–¹æ³•è¯´æ˜</p>
<p>t.start() : æ¿€æ´»çº¿ç¨‹ï¼Œ</p>
<p>t.getName() : è·å–çº¿ç¨‹çš„åç§°</p>
<p>t.setName() ï¼š è®¾ç½®çº¿ç¨‹çš„åç§°</p>
<p>t.name : è·å–æˆ–è®¾ç½®çº¿ç¨‹çš„åç§°</p>
<p>t.is_alive() ï¼š åˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸ºæ¿€æ´»çŠ¶æ€</p>
<p>t.isAlive() ï¼šåˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸ºæ¿€æ´»çŠ¶æ€</p>
<p>t.setDaemon() è®¾ç½®ä¸ºåå°çº¿ç¨‹æˆ–å‰å°çº¿ç¨‹ï¼ˆé»˜è®¤ï¼šFalseï¼‰;é€šè¿‡ä¸€ä¸ªå¸ƒå°”å€¼è®¾ç½®çº¿ç¨‹æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œå¿…é¡»åœ¨æ‰§è¡Œstart()æ–¹æ³•ä¹‹åæ‰å¯ä»¥ä½¿ç”¨ã€‚å¦‚æœæ˜¯åå°çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œåå°çº¿ç¨‹ä¹Ÿåœ¨è¿›è¡Œï¼Œä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œåå°çº¿ç¨‹ä¸è®ºæˆåŠŸä¸å¦ï¼Œå‡åœæ­¢ï¼›å¦‚æœæ˜¯å‰å°çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå‰å°çº¿ç¨‹ä¹Ÿåœ¨è¿›è¡Œï¼Œä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œç­‰å¾…å‰å°çº¿ç¨‹ä¹Ÿæ‰§è¡Œå®Œæˆåï¼Œç¨‹åºåœæ­¢</p>
<p>t.isDaemon() ï¼š åˆ¤æ–­æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹</p>
<p>t.ident ï¼šè·å–çº¿ç¨‹çš„æ ‡è¯†ç¬¦ã€‚çº¿ç¨‹æ ‡è¯†ç¬¦æ˜¯ä¸€ä¸ªéé›¶æ•´æ•°ï¼Œåªæœ‰åœ¨è°ƒç”¨äº†start()æ–¹æ³•ä¹‹åè¯¥å±æ€§æ‰æœ‰æ•ˆï¼Œå¦åˆ™å®ƒåªè¿”å›Noneã€‚</p>
<p>t.join() ï¼šé€ä¸ªæ‰§è¡Œæ¯ä¸ªçº¿ç¨‹ï¼Œæ‰§è¡Œå®Œæ¯•åç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œè¯¥æ–¹æ³•ä½¿å¾—å¤šçº¿ç¨‹å˜å¾—æ— æ„ä¹‰</p>
<p>t.run() ï¼šçº¿ç¨‹è¢«cpuè°ƒåº¦åè‡ªåŠ¨æ‰§è¡Œçº¿ç¨‹å¯¹è±¡çš„runæ–¹æ³•</p>
<p>2ã€çº¿ç¨‹é”threading.RLockå’Œthreading.Lock</p>
<p>ç”±äºçº¿ç¨‹ä¹‹é—´æ˜¯è¿›è¡Œéšæœºè°ƒåº¦ï¼Œå¹¶ä¸”æ¯ä¸ªçº¿ç¨‹å¯èƒ½åªæ‰§è¡Œnæ¡æ‰§è¡Œä¹‹åï¼ŒCPUæ¥ç€æ‰§è¡Œå…¶ä»–çº¿ç¨‹ã€‚ä¸ºäº†ä¿è¯æ•°æ®çš„å‡†ç¡®æ€§ï¼Œå¼•å…¥äº†é”çš„æ¦‚å¿µã€‚æ‰€ä»¥ï¼Œå¯èƒ½å‡ºç°å¦‚ä¸‹é—®é¢˜ï¼š</p>
<p>ä¾‹ï¼šå‡è®¾åˆ—è¡¨Açš„æ‰€æœ‰å…ƒç´ å°±ä¸º0ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹ä»å‰å‘åæ‰“å°åˆ—è¡¨çš„æ‰€æœ‰å…ƒç´ ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹åˆ™ä»åå‘å‰ä¿®æ”¹åˆ—è¡¨çš„å…ƒç´ ä¸º1,é‚£ä¹ˆè¾“å‡ºçš„æ—¶å€™ï¼Œåˆ—è¡¨çš„å…ƒç´ å°±ä¼šä¸€éƒ¨åˆ†ä¸º0ï¼Œä¸€éƒ¨åˆ†ä¸º1,è¿™å°±å¯¼è‡´äº†æ•°æ®çš„ä¸ä¸€è‡´ã€‚é”çš„å‡ºç°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
<pre><code>import threading
import time
   
globals_num = 0
   
lock = threading.RLock()
   
def Func():
    lock.acquire()  # è·å¾—é”
    global globals_num
    globals_num += 1
    time.sleep(1)
    print(globals_num)
    lock.release()  # é‡Šæ”¾é”
   
for i in range(10):
    t = threading.Thread(target=Func)
    t.start()
</code></pre>
<p><strong>3ã€threading.RLockå’Œthreading.Lock çš„åŒºåˆ«</strong><br>
RLockå…è®¸åœ¨åŒä¸€çº¿ç¨‹ä¸­è¢«å¤šæ¬¡acquireã€‚è€ŒLockå´ä¸å…è®¸è¿™ç§æƒ…å†µã€‚ å¦‚æœä½¿ç”¨RLockï¼Œé‚£ä¹ˆacquireå’Œreleaseå¿…é¡»æˆå¯¹å‡ºç°ï¼Œå³è°ƒç”¨äº†næ¬¡acquireï¼Œå¿…é¡»è°ƒç”¨næ¬¡çš„releaseæ‰èƒ½çœŸæ­£é‡Šæ”¾æ‰€å ç”¨çš„çã€‚</p>
<pre><code>
import threading
lock = threading.Lock()    #Lockå¯¹è±¡
lock.acquire()
lock.acquire()  #äº§ç”Ÿäº†æ­»çã€‚
lock.release()
lock.release()ã€€
import threading
rLock = threading.RLock()  #RLockå¯¹è±¡
rLock.acquire()
rLock.acquire()    #åœ¨åŒä¸€çº¿ç¨‹å†…ï¼Œç¨‹åºä¸ä¼šå µå¡ã€‚
rLock.release()
rLock.release()
</code></pre>
<p><strong>4ã€threading.Event</strong></p>
<p>pythonçº¿ç¨‹çš„äº‹ä»¶ç”¨äºä¸»çº¿ç¨‹æ§åˆ¶å…¶ä»–çº¿ç¨‹çš„æ‰§è¡Œï¼Œäº‹ä»¶ä¸»è¦æä¾›äº†ä¸‰ä¸ªæ–¹æ³• setã€waitã€clearã€‚</p>
<p>äº‹ä»¶å¤„ç†çš„æœºåˆ¶ï¼šå…¨å±€å®šä¹‰äº†ä¸€ä¸ªâ€œFlagâ€ï¼Œå¦‚æœâ€œFlagâ€å€¼ä¸º Falseï¼Œé‚£ä¹ˆå½“ç¨‹åºæ‰§è¡Œ event.wait æ–¹æ³•æ—¶å°±ä¼šé˜»å¡ï¼Œå¦‚æœâ€œFlagâ€å€¼ä¸ºTrueï¼Œé‚£ä¹ˆevent.wait æ–¹æ³•æ—¶ä¾¿ä¸å†é˜»å¡ã€‚</p>
<p>clearï¼šå°†â€œFlagâ€è®¾ç½®ä¸ºFalse</p>
<p>setï¼šå°†â€œFlagâ€è®¾ç½®ä¸ºTrue</p>
<p>Event.isSet() ï¼šåˆ¤æ–­æ ‡è¯†ä½æ˜¯å¦ä¸ºTureã€‚</p>
<pre><code>import threading
   
def do(event):
    print('start')
    event.wait()
    print('execute')
   
event_obj = threading.Event()
for i in range(10):
    t = threading.Thread(target=do, args=(event_obj,))
    t.start()
   
event_obj.clear()
inp = input('input:')
if inp == 'true':
    event_obj.set()
</code></pre>
<p>å½“çº¿ç¨‹æ‰§è¡Œçš„æ—¶å€™ï¼Œå¦‚æœflagä¸ºFalseï¼Œåˆ™çº¿ç¨‹ä¼šé˜»å¡ï¼Œå½“flagä¸ºTrueçš„æ—¶å€™ï¼Œçº¿ç¨‹ä¸ä¼šé˜»å¡ã€‚å®ƒæä¾›äº†æœ¬åœ°å’Œè¿œç¨‹çš„å¹¶å‘æ€§ã€‚</p>
<p><strong>5ã€threading.Condition</strong></p>
<p>ä¸€ä¸ªconditionå˜é‡æ€»æ˜¯ä¸æŸäº›ç±»å‹çš„é”ç›¸è”ç³»ï¼Œè¿™ä¸ªå¯ä»¥ä½¿ç”¨é»˜è®¤çš„æƒ…å†µæˆ–åˆ›å»ºä¸€ä¸ªï¼Œå½“å‡ ä¸ªconditionå˜é‡å¿…é¡»å…±äº«å’ŒåŒä¸€ä¸ªé”çš„æ—¶å€™ï¼Œæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚é”æ˜¯conditonå¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼šæ²¡æœ‰å¿…è¦åˆ†åˆ«è·Ÿè¸ªã€‚</p>
<p>conditionå˜é‡æœä»ä¸Šä¸‹æ–‡ç®¡ç†åè®®ï¼šwithè¯­å¥å—å°é—­ä¹‹å‰å¯ä»¥è·å–ä¸é”çš„è”ç³»ã€‚ acquire() å’Œ release() ä¼šè°ƒç”¨ä¸é”ç›¸å…³è”çš„ç›¸åº”çš„æ–¹æ³•ã€‚</p>
<p>å…¶ä»–å’Œé”å…³è”çš„æ–¹æ³•å¿…é¡»è¢«è°ƒç”¨ï¼Œwait()æ–¹æ³•ä¼šé‡Šæ”¾é”ï¼Œå½“å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ notify() or notify_all()å”¤é†’å®ƒä¹‹å‰ä¼šä¸€ç›´é˜»å¡ã€‚ä¸€æ—¦è¢«å”¤é†’ï¼Œwait()ä¼šé‡æ–°è·å¾—é”å¹¶è¿”å›ï¼Œ</p>
<p>Conditionç±»å®ç°äº†ä¸€ä¸ªconditonå˜é‡ã€‚ è¿™ä¸ªconditiaonå˜é‡å…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°ä»–ä»¬è¢«å¦ä¸€ä¸ªçº¿ç¨‹é€šçŸ¥ã€‚ å¦‚æœlockå‚æ•°ï¼Œè¢«ç»™å®šä¸€ä¸ªéç©ºçš„å€¼ï¼Œï¼Œé‚£ä¹ˆä»–å¿…é¡»æ˜¯ä¸€ä¸ªlockæˆ–è€…Rlockå¯¹è±¡ï¼Œå®ƒç”¨æ¥åšåº•å±‚é”ã€‚å¦åˆ™ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Rlockå¯¹è±¡ï¼Œç”¨æ¥åšåº•å±‚é”ã€‚</p>
<p>wait(timeout=None) ï¼š ç­‰å¾…é€šçŸ¥ï¼Œæˆ–è€…ç­‰åˆ°è®¾å®šçš„è¶…æ—¶æ—¶é—´ã€‚å½“è°ƒç”¨è¿™wait()æ–¹æ³•æ—¶ï¼Œå¦‚æœè°ƒç”¨å®ƒçš„çº¿ç¨‹æ²¡æœ‰å¾—åˆ°é”ï¼Œé‚£ä¹ˆä¼šæŠ›å‡ºä¸€ä¸ªRuntimeError å¼‚å¸¸ã€‚ wati()é‡Šæ”¾é”ä»¥åï¼Œåœ¨è¢«è°ƒç”¨ç›¸åŒæ¡ä»¶çš„å¦ä¸€ä¸ªè¿›ç¨‹ç”¨notify() or notify_all() å«é†’ä¹‹å‰ ä¼šä¸€ç›´é˜»å¡ã€‚wait() è¿˜å¯ä»¥æŒ‡å®šä¸€ä¸ªè¶…æ—¶æ—¶é—´ã€‚</p>
<p>å¦‚æœæœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œnotify()æ–¹æ³•ä¼šå”¤é†’ä¸€ä¸ªåœ¨ç­‰å¾…conditonå˜é‡çš„çº¿ç¨‹ã€‚notify_all() åˆ™ä¼šå”¤é†’æ‰€æœ‰åœ¨ç­‰å¾…conditonå˜é‡çš„çº¿ç¨‹ã€‚</p>
<p>æ³¨æ„ï¼š notify()å’Œnotify_all()ä¸ä¼šé‡Šæ”¾é”ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹è¢«å”¤é†’åä¸ä¼šç«‹åˆ»è¿”å›ä»–ä»¬çš„wait() è°ƒç”¨ã€‚é™¤éçº¿ç¨‹è°ƒç”¨notify()å’Œnotify_all()ä¹‹åæ”¾å¼ƒäº†é”çš„æ‰€æœ‰æƒã€‚</p>
<p>åœ¨å…¸å‹çš„è®¾è®¡é£æ ¼é‡Œï¼Œåˆ©ç”¨conditionå˜é‡ç”¨é”å»é€šè®¸è®¿é—®ä¸€äº›å…±äº«çŠ¶æ€ï¼Œçº¿ç¨‹åœ¨è·å–åˆ°å®ƒæƒ³å¾—åˆ°çš„çŠ¶æ€å‰ï¼Œä¼šåå¤è°ƒç”¨wait()ã€‚ä¿®æ”¹çŠ¶æ€çš„çº¿ç¨‹åœ¨ä»–ä»¬çŠ¶æ€æ”¹å˜æ—¶è°ƒç”¨ notify() or notify_all()ï¼Œç”¨è¿™ç§æ–¹å¼ï¼Œçº¿ç¨‹ä¼šå°½å¯èƒ½çš„è·å–åˆ°æƒ³è¦çš„ä¸€ä¸ªç­‰å¾…è€…çŠ¶æ€ã€‚ ä¾‹å­ï¼š ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Œ</p>
<pre><code>import threading
import time
def consumer(cond):
    with cond:
        print(&quot;consumer before wait&quot;)
        cond.wait()
        print(&quot;consumer after wait&quot;)
   
def producer(cond):
    with cond:
        print(&quot;producer before notifyAll&quot;)
        cond.notifyAll()
        print(&quot;producer after notifyAll&quot;)
   
condition = threading.Condition()
c1 = threading.Thread(name=&quot;c1&quot;, target=consumer, args=(condition,))
c2 = threading.Thread(name=&quot;c2&quot;, target=consumer, args=(condition,))
   
p = threading.Thread(name=&quot;p&quot;, target=producer, args=(condition,))
   
c1.start()
time.sleep(2)
c2.start()
time.sleep(2)
p.start()
</code></pre>
<p><strong>6ã€queueæ¨¡å—</strong></p>
<p>Queue å°±æ˜¯å¯¹é˜Ÿåˆ—ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„</p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬å»éº¦å½“åŠ³åƒé¥­ã€‚é¥­åº—é‡Œé¢æœ‰å¨å¸ˆèŒä½ï¼Œå‰å°è´Ÿè´£æŠŠå¨æˆ¿åšå¥½çš„é¥­å–ç»™é¡¾å®¢ï¼Œé¡¾å®¢åˆ™å»å‰å°é¢†å–åšå¥½çš„é¥­ã€‚è¿™é‡Œçš„å‰å°å°±ç›¸å½“äºæˆ‘ä»¬çš„é˜Ÿåˆ—ã€‚å½¢æˆç®¡é“æ ·ï¼Œå¨å¸ˆåšå¥½é¥­é€šè¿‡å‰å°ä¼ é€ç»™é¡¾å®¢ï¼Œæ‰€è°“å•å‘é˜Ÿåˆ—</p>
<p>è¿™ä¸ªæ¨¡å‹ä¹Ÿå«ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ã€‚</p>
<p>import queue</p>
<p>q = queue.Queue(maxsize=0)  # æ„é€ ä¸€ä¸ªå…ˆè¿›æ˜¾å‡ºé˜Ÿåˆ—ï¼ŒmaxsizeæŒ‡å®šé˜Ÿåˆ—é•¿åº¦ï¼Œä¸º0 æ—¶ï¼Œè¡¨ç¤ºé˜Ÿåˆ—é•¿åº¦æ— é™åˆ¶ã€‚</p>
<p>q.join()    # ç­‰åˆ°é˜Ÿåˆ—ä¸ºkongçš„æ—¶å€™ï¼Œåœ¨æ‰§è¡Œåˆ«çš„æ“ä½œ<br>
q.qsize()   # è¿”å›é˜Ÿåˆ—çš„å¤§å° ï¼ˆä¸å¯é ï¼‰<br>
q.empty()   # å½“é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™ï¼Œè¿”å›True å¦åˆ™è¿”å›False ï¼ˆä¸å¯é ï¼‰<br>
q.full()    # å½“é˜Ÿåˆ—æ»¡çš„æ—¶å€™ï¼Œè¿”å›Trueï¼Œå¦åˆ™è¿”å›False ï¼ˆä¸å¯é ï¼‰<br>
q.put(item, block=True, timeout=None) #  å°†itemæ”¾å…¥Queueå°¾éƒ¨ï¼Œitemå¿…é¡»å­˜åœ¨ï¼Œå¯ä»¥å‚æ•°blocké»˜è®¤ä¸ºTrue,è¡¨ç¤ºå½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œä¼šç­‰å¾…é˜Ÿåˆ—ç»™å‡ºå¯ç”¨ä½ç½®ï¼Œ<br>
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ ä¸ºFalseæ—¶ä¸ºéé˜»å¡ï¼Œæ­¤æ—¶å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œä¼šå¼•å‘queue.Full å¼‚å¸¸ã€‚ å¯é€‰å‚æ•°timeoutï¼Œè¡¨ç¤º ä¼šé˜»å¡è®¾ç½®çš„æ—¶é—´ï¼Œè¿‡åï¼Œ<br>
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€  å¦‚æœé˜Ÿåˆ—æ— æ³•ç»™å‡ºæ”¾å…¥itemçš„ä½ç½®ï¼Œåˆ™å¼•å‘ queue.Full å¼‚å¸¸<br>
q.get(block=True, timeout=None) #   ç§»é™¤å¹¶è¿”å›é˜Ÿåˆ—å¤´éƒ¨çš„ä¸€ä¸ªå€¼ï¼Œå¯é€‰å‚æ•°blocké»˜è®¤ä¸ºTrueï¼Œè¡¨ç¤ºè·å–å€¼çš„æ—¶å€™ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™é˜»å¡ï¼Œä¸ºFalseæ—¶ï¼Œä¸é˜»å¡ï¼Œ<br>
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€è‹¥æ­¤æ—¶é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™å¼•å‘ queue.Emptyå¼‚å¸¸ã€‚ å¯é€‰å‚æ•°timeoutï¼Œè¡¨ç¤ºä¼šé˜»å¡è®¾ç½®çš„æ—¶å€™ï¼Œè¿‡åï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™å¼•å‘Emptyå¼‚å¸¸ã€‚<br>
q.put_nowait(item) #   ç­‰æ•ˆäº put(item,block=False)<br>
q.get_nowait() #    ç­‰æ•ˆäº get(item,block=False)<br>
ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>
#!/usr/bin/env python
import Queue
import threading
message = Queue.Queue(10)
  
  
def producer(i):
    while True:
        message.put(i)
  
  
def consumer(i):
    while True:
        msg = message.get()
  
  
for i in range(12):
    t = threading.Thread(target=producer, args=(i,))
    t.start()
  
for i in range(10):
    t = threading.Thread(target=consumer, args=(i,))
    t.start()
é‚£å°±è‡ªå·±åšä¸ªçº¿ç¨‹æ± å§ï¼š

# ç®€å•å¾€é˜Ÿåˆ—ä¸­ä¼ è¾“çº¿ç¨‹æ•°
import threading
import time
import queue
class Threadingpool():
    def __init__(self,max_num = 10):
        self.queue = queue.Queue(max_num)
        for i in range(max_num):
            self.queue.put(threading.Thread)
    def getthreading(self):
        return self.queue.get()
    def addthreading(self):
        self.queue.put(threading.Thread)
def func(p,i):
    time.sleep(1)
    print(i)
    p.addthreading()
if __name__ == &quot;__main__&quot;:
    p = Threadingpool()
    for i in range(20):
        thread = p.getthreading()
        t = thread(target = func, args = (p,i))
        t.start()


#å¾€é˜Ÿåˆ—ä¸­æ— é™æ·»åŠ ä»»åŠ¡
import queue
import threading
import contextlib
import time
StopEvent = object()
class ThreadPool(object):
    def __init__(self, max_num):
        self.q = queue.Queue()
        self.max_num = max_num
        self.terminal = False
        self.generate_list = []
        self.free_list = []
    def run(self, func, args, callback=None):
        &quot;&quot;&quot;
        çº¿ç¨‹æ± æ‰§è¡Œä¸€ä¸ªä»»åŠ¡
        :param func: ä»»åŠ¡å‡½æ•°
        :param args: ä»»åŠ¡å‡½æ•°æ‰€éœ€å‚æ•°
        :param callback: ä»»åŠ¡æ‰§è¡Œå¤±è´¥æˆ–æˆåŠŸåæ‰§è¡Œçš„å›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°1ã€ä»»åŠ¡å‡½æ•°æ‰§è¡ŒçŠ¶æ€ï¼›2ã€ä»»åŠ¡å‡½æ•°è¿”å›å€¼ï¼ˆé»˜è®¤ä¸ºNoneï¼Œå³ï¼šä¸æ‰§è¡Œå›è°ƒå‡½æ•°ï¼‰
        :return: å¦‚æœçº¿ç¨‹æ± å·²ç»ç»ˆæ­¢ï¼Œåˆ™è¿”å›Trueå¦åˆ™None
        &quot;&quot;&quot;
        if len(self.free_list) == 0 and len(self.generate_list) &lt; self.max_num:
            self.generate_thread()
        w = (func, args, callback,)
        self.q.put(w)
    def generate_thread(self):
        &quot;&quot;&quot;
        åˆ›å»ºä¸€ä¸ªçº¿ç¨‹
        &quot;&quot;&quot;
        t = threading.Thread(target=self.call)
        t.start()
    def call(self):
        &quot;&quot;&quot;
        å¾ªç¯å»è·å–ä»»åŠ¡å‡½æ•°å¹¶æ‰§è¡Œä»»åŠ¡å‡½æ•°
        &quot;&quot;&quot;
        current_thread = threading.currentThread
        self.generate_list.append(current_thread)
        event = self.q.get()  # è·å–çº¿ç¨‹
        while event != StopEvent:   # åˆ¤æ–­è·å–çš„çº¿ç¨‹æ•°ä¸ç­‰äºå…¨å±€å˜é‡
            func, arguments, callback = event   # æ‹†åˆ†å…ƒç¥–ï¼Œè·å¾—æ‰§è¡Œå‡½æ•°ï¼Œå‚æ•°ï¼Œå›è°ƒå‡½æ•°
            try:
                result = func(*arguments)   # æ‰§è¡Œå‡½æ•°
                status = True
            except Exception as e:    # å‡½æ•°æ‰§è¡Œå¤±è´¥
                status = False
                result = e
            if callback is not None:
                try:
                    callback(status, result)
                except Exception as e:
                    pass
            # self.free_list.append(current_thread)
            # event = self.q.get()
            # self.free_list.remove(current_thread)
            with self.work_state():
                event = self.q.get()
        else:
            self.generate_list.remove(current_thread)
    def close(self):
        &quot;&quot;&quot;
        å…³é—­çº¿ç¨‹ï¼Œç»™ä¼ è¾“å…¨å±€éå…ƒç¥–çš„å˜é‡æ¥è¿›è¡Œå…³é—­
        :return:
        &quot;&quot;&quot;
        for i in range(len(self.generate_list)):
            self.q.put(StopEvent)
    def terminate(self):
        &quot;&quot;&quot;
        çªç„¶å…³é—­çº¿ç¨‹
        :return:
        &quot;&quot;&quot;
        self.terminal = True
        while self.generate_list:
            self.q.put(StopEvent)
        self.q.empty()
    @contextlib.contextmanager
    def work_state(self):
        self.free_list.append(threading.currentThread)
        try:
            yield
        finally:
            self.free_list.remove(threading.currentThread)
def work(i):
    print(i)
    return i +1 # è¿”å›ç»™å›è°ƒå‡½æ•°
def callback(ret):
    print(ret)
pool = ThreadPool(10)
for item in range(50):
    pool.run(func=work, args=(item,),callback=callback)
pool.terminate()
# pool.close()
</code></pre>
<p><strong>python è¿›ç¨‹</strong><br>
multiprocessingæ˜¯pythonçš„å¤šè¿›ç¨‹ç®¡ç†åŒ…ï¼Œå’Œthreading.Threadç±»ä¼¼ã€‚</p>
<p><strong>1ã€multiprocessingæ¨¡å—</strong></p>
<p>ç›´æ¥ä»ä¾§é¢ç”¨subprocessesæ›¿æ¢çº¿ç¨‹ä½¿ç”¨GILçš„æ–¹å¼ï¼Œç”±äºè¿™ä¸€ç‚¹ï¼Œmultiprocessingæ¨¡å—å¯ä»¥è®©ç¨‹åºå‘˜åœ¨ç»™å®šçš„æœºå™¨ä¸Šå……åˆ†çš„åˆ©ç”¨CPUã€‚åœ¨multiprocessingä¸­ï¼Œé€šè¿‡åˆ›å»ºProcesså¯¹è±¡ç”Ÿæˆè¿›ç¨‹ï¼Œç„¶åè°ƒç”¨å®ƒçš„start()æ–¹æ³•ï¼Œ</p>
<pre><code>
from multiprocessing import Process
  
def func(name):
    print('hello', name)
  
  
if __name__ == &quot;__main__&quot;:
    p = Process(target=func,args=('zhangyanlin',))
    p.start()
    p.join()  # ç­‰å¾…è¿›ç¨‹æ‰§è¡Œå®Œæ¯•
</code></pre>
<p>åœ¨ä½¿ç”¨å¹¶å‘è®¾è®¡çš„æ—¶å€™æœ€å¥½å°½å¯èƒ½çš„é¿å…å…±äº«æ•°æ®ï¼Œå°¤å…¶æ˜¯åœ¨ä½¿ç”¨å¤šè¿›ç¨‹çš„æ—¶å€™ã€‚ å¦‚æœä½ çœŸæœ‰éœ€è¦ è¦å…±äº«æ•°æ®ï¼Œ multiprocessingæä¾›äº†ä¸¤ç§æ–¹å¼ã€‚</p>
<p>ï¼ˆ1ï¼‰multiprocessingï¼ŒArray,Value</p>
<p>æ•°æ®å¯ä»¥ç”¨Valueæˆ–Arrayå­˜å‚¨åœ¨ä¸€ä¸ªå…±äº«å†…å­˜åœ°å›¾é‡Œï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code>from multiprocessing import Array,Value,Process
  
def func(a,b):
    a.value = 3.333333333333333
    for i in range(len(b)):
        b[i] = -b[i]
  
  
if __name__ == &quot;__main__&quot;:
    num = Value('d',0.0)
    arr = Array('i',range(11))
  
  
    c = Process(target=func,args=(num,arr))
    d= Process(target=func,args=(num,arr))
    c.start()
    d.start()
    c.join()
    d.join()
  
    print(num.value)
    for i in arr:
        print(i)
</code></pre>
<p>è¾“å‡ºï¼š</p>
<p>3.1415927<br>
[0, -1, -2, -3, -4, -5, -6, -7, -8, -9]<br>
åˆ›å»ºnumå’Œarræ—¶ï¼Œâ€œdâ€å’Œâ€œiâ€å‚æ•°ç”±Arrayæ¨¡å—ä½¿ç”¨çš„typecodesåˆ›å»ºï¼šâ€œdâ€è¡¨ç¤ºä¸€ä¸ªåŒç²¾åº¦çš„æµ®ç‚¹æ•°ï¼Œâ€œiâ€è¡¨ç¤ºä¸€ä¸ªæœ‰ç¬¦å·çš„æ•´æ•°ï¼Œè¿™äº›å…±äº«å¯¹è±¡å°†è¢«çº¿ç¨‹å®‰å…¨çš„å¤„ç†ã€‚</p>
<p>Array(â€˜iâ€™, range(10))ä¸­çš„â€˜iâ€™å‚æ•°ï¼š</p>
<p>â€˜câ€™: ctypes.c_charã€€ã€€ã€€ã€€ â€˜uâ€™: ctypes.c_wcharã€€ã€€ã€€ã€€â€˜bâ€™: ctypes.c_byteã€€ã€€ã€€ã€€ â€˜Bâ€™: ctypes.c_ubyte</p>
<p>â€˜hâ€™: ctypes.c_shortã€€ã€€ã€€  â€˜Hâ€™: ctypes.c_ushortã€€ã€€  â€˜iâ€™: ctypes.c_intã€€ã€€ã€€ã€€ã€€ â€˜Iâ€™: ctypes.c_uint</p>
<p>â€˜lâ€™: ctypes.c_long,ã€€ã€€ã€€ã€€â€˜Lâ€™: ctypes.c_ulongã€€ã€€ã€€ã€€â€˜fâ€™: ctypes.c_floatã€€ã€€ã€€ã€€â€˜dâ€™: ctypes.c_double</p>
<p><strong>ï¼ˆ2ï¼‰multiprocessingï¼ŒManager</strong></p>
<p>ç”±Manager()è¿”å›çš„manageræä¾›list, dict, Namespace, Lock, RLock, Semaphore, BoundedSemaphore, Condition, Event, Barrier, Queue, Value and Arrayç±»å‹çš„æ”¯æŒã€‚</p>
<pre><code>
from multiprocessing import Process,Manager
def f(d,l):
    d[&quot;name&quot;] = &quot;zhangyanlin&quot;
    d[&quot;age&quot;] = 18
    d[&quot;Job&quot;] = &quot;pythoner&quot;
    l.reverse()
  
if __name__ == &quot;__main__&quot;:
    with Manager() as man:
        d = man.dict()
        l = man.list(range(10))
  
        p = Process(target=f,args=(d,l))
        p.start()
        p.join()
  
        print(d)
        print(l)
</code></pre>
<p><strong>è¾“å‡ºï¼š</strong></p>
<pre><code>{0.25: None, 1: '1', '2': 2}
[9, 8, 7, 6, 5, 4, 3, 2, 1, 0]
Server process manageræ¯” shared memory æ›´çµæ´»ï¼Œå› ä¸ºå®ƒå¯ä»¥æ”¯æŒä»»æ„çš„å¯¹è±¡ç±»å‹ã€‚å¦å¤–ï¼Œä¸€ä¸ªå•ç‹¬çš„managerå¯ä»¥é€šè¿‡è¿›ç¨‹åœ¨ç½‘ç»œä¸Šä¸åŒçš„è®¡ç®—æœºä¹‹é—´å…±äº«ï¼Œä¸è¿‡ä»–æ¯”shared memoryè¦æ…¢ã€‚
</code></pre>
<p><strong>2ã€è¿›ç¨‹æ± ï¼ˆUsing a pool of workersï¼‰</strong></p>
<p>Poolç±»æè¿°äº†ä¸€ä¸ªå·¥ä½œè¿›ç¨‹æ± ï¼Œä»–æœ‰å‡ ç§ä¸åŒçš„æ–¹æ³•è®©ä»»åŠ¡å¸è½½å·¥ä½œè¿›ç¨‹ã€‚</p>
<p>è¿›ç¨‹æ± å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªè¿›ç¨‹åºåˆ—ï¼Œå½“ä½¿ç”¨æ—¶ï¼Œåˆ™å»è¿›ç¨‹æ± ä¸­è·å–ä¸€ä¸ªè¿›ç¨‹ï¼Œå¦‚æœè¿›ç¨‹æ± åºåˆ—ä¸­æ²¡æœ‰å¯ä¾›ä½¿ç”¨çš„è¿›è¿›ç¨‹ï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šç­‰å¾…ï¼Œç›´åˆ°è¿›ç¨‹æ± ä¸­æœ‰å¯ç”¨è¿›ç¨‹ä¸ºæ­¢ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç”¨Poolç±»åˆ›å»ºä¸€ä¸ªè¿›ç¨‹æ± ï¼Œ å±•å¼€æäº¤çš„ä»»åŠ¡ç»™è¿›ç¨‹æ± ã€‚ ä¾‹ï¼š</p>
<pre><code>#apply
from  multiprocessing import Pool
import time
  
def f1(i):
    time.sleep(0.5)
    print(i)
    return i + 100
  
if __name__ == &quot;__main__&quot;:
    pool = Pool(5)
    for i in range(1,31):
        pool.apply(func=f1,args=(i,))
  
#apply_async
def f1(i):
    time.sleep(0.5)
    print(i)
    return i + 100
def f2(arg):
    print(arg)
  
if __name__ == &quot;__main__&quot;:
    pool = Pool(5)
    for i in range(1,31):
        pool.apply_async(func=f1,args=(i,),callback=f2)
    pool.close()
    pool.join()
</code></pre>
<p>ä¸€ä¸ªè¿›ç¨‹æ± å¯¹è±¡å¯ä»¥æ§åˆ¶å·¥ä½œè¿›ç¨‹æ± çš„å“ªäº›å·¥ä½œå¯ä»¥è¢«æäº¤ï¼Œå®ƒæ”¯æŒè¶…æ—¶å’Œå›è°ƒçš„å¼‚æ­¥ç»“æœï¼Œæœ‰ä¸€ä¸ªç±»ä¼¼mapçš„å®ç°ã€‚</p>
<p>processes ï¼šä½¿ç”¨çš„å·¥ä½œè¿›ç¨‹çš„æ•°é‡ï¼Œå¦‚æœprocessesæ˜¯Noneé‚£ä¹ˆä½¿ç”¨ os.cpu_count()è¿”å›çš„æ•°é‡ã€‚</p>
<p>initializerï¼š å¦‚æœinitializeræ˜¯Noneï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªå·¥ä½œè¿›ç¨‹åœ¨å¼€å§‹çš„æ—¶å€™ä¼šè°ƒç”¨initializer(*initargs)ã€‚</p>
<p>maxtasksperchildï¼šå·¥ä½œè¿›ç¨‹é€€å‡ºä¹‹å‰å¯ä»¥å®Œæˆçš„ä»»åŠ¡æ•°ï¼Œå®Œæˆåç”¨ä¸€ä¸ªå¿ƒçš„å·¥ä½œè¿›ç¨‹æ¥æ›¿ä»£åŸè¿›ç¨‹ï¼Œæ¥è®©é—²ç½®çš„èµ„æºè¢«é‡Šæ”¾ã€‚maxtasksperchildé»˜è®¤æ˜¯Noneï¼Œæ„å‘³ç€åªè¦Poolå­˜åœ¨å·¥ä½œè¿›ç¨‹å°±ä¼šä¸€ç›´å­˜æ´»ã€‚</p>
<p>context: ç”¨åœ¨åˆ¶å®šå·¥ä½œè¿›ç¨‹å¯åŠ¨æ—¶çš„ä¸Šä¸‹æ–‡ï¼Œä¸€èˆ¬ä½¿ç”¨ multiprocessing.Pool() æˆ–è€…ä¸€ä¸ªcontextå¯¹è±¡çš„Pool()æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ± ï¼Œä¸¤ç§æ–¹æ³•éƒ½é€‚å½“çš„è®¾ç½®äº†context</p>
<p>æ³¨æ„ï¼šPoolå¯¹è±¡çš„æ–¹æ³•åªå¯ä»¥è¢«åˆ›å»ºpoolçš„è¿›ç¨‹æ‰€è°ƒç”¨ã€‚</p>
<pre><code>New in version 3.2: maxtasksperchild

New in version 3.4: context
</code></pre>
<p><strong>è¿›ç¨‹æ± çš„æ–¹æ³•</strong><br>
apply(func[, args[, kwds]]) ï¼šä½¿ç”¨argå’Œkwdså‚æ•°è°ƒç”¨funcå‡½æ•°ï¼Œç»“æœè¿”å›å‰ä¼šä¸€ç›´é˜»å¡ï¼Œç”±äºè¿™ä¸ªåŸå› ï¼Œapply_async()æ›´é€‚åˆå¹¶å‘æ‰§è¡Œï¼Œå¦å¤–ï¼Œfuncå‡½æ•°ä»…è¢«poolä¸­çš„ä¸€ä¸ªè¿›ç¨‹è¿è¡Œã€‚</p>
<p>apply_async(func[, args[, kwds[, callback[, error_callback]]]]) ï¼š apply()æ–¹æ³•çš„ä¸€ä¸ªå˜ä½“ï¼Œä¼šè¿”å›ä¸€ä¸ªç»“æœå¯¹è±¡ã€‚å¦‚æœcallbackè¢«æŒ‡å®šï¼Œé‚£ä¹ˆcallbackå¯ä»¥æ¥æ”¶ä¸€ä¸ªå‚æ•°ç„¶åè¢«è°ƒç”¨ï¼Œå½“ç»“æœå‡†å¤‡å¥½å›è°ƒæ—¶ä¼šè°ƒç”¨callbackï¼Œè°ƒç”¨å¤±è´¥æ—¶ï¼Œåˆ™ç”¨error_callbackæ›¿æ¢callbackã€‚ Callbacksåº”è¢«ç«‹å³å®Œæˆï¼Œå¦åˆ™å¤„ç†ç»“æœçš„çº¿ç¨‹ä¼šè¢«é˜»å¡ã€‚</p>
<p>close() ï¼š é˜»æ­¢æ›´å¤šçš„ä»»åŠ¡æäº¤åˆ°poolï¼Œå¾…ä»»åŠ¡å®Œæˆåï¼Œå·¥ä½œè¿›ç¨‹ä¼šé€€å‡ºã€‚</p>
<p>terminate() ï¼š ä¸ç®¡ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œç«‹å³åœæ­¢å·¥ä½œè¿›ç¨‹ã€‚åœ¨å¯¹poolå¯¹è±¡è¿›ç¨‹åƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œä¼šç«‹å³è°ƒç”¨terminate()ã€‚</p>
<p>join() : waitå·¥ä½œçº¿ç¨‹çš„é€€å‡ºï¼Œåœ¨è°ƒç”¨join()å‰ï¼Œå¿…é¡»è°ƒç”¨close() or terminate()ã€‚è¿™æ ·æ˜¯å› ä¸ºè¢«ç»ˆæ­¢çš„è¿›ç¨‹éœ€è¦è¢«çˆ¶è¿›ç¨‹è°ƒç”¨waitï¼ˆjoinç­‰ä»·ä¸waitï¼‰ï¼Œå¦åˆ™è¿›ç¨‹ä¼šæˆä¸ºåƒµå°¸è¿›ç¨‹ã€‚</p>
<pre><code>
map(func, iterable[, chunksize])Â¶

map_async(func, iterable[, chunksize[, callback[, error_callback]]])Â¶

imap(func, iterable[, chunksize])Â¶

imap_unordered(func, iterable[, chunksize])

starmap(func, iterable[, chunksize])Â¶

starmap_async(func, iterable[, chunksize[, callback[, error_back]]])
</code></pre>
<p><strong>python åç¨‹</strong></p>
<p>çº¿ç¨‹å’Œè¿›ç¨‹çš„æ“ä½œæ˜¯ç”±ç¨‹åºè§¦å‘ç³»ç»Ÿæ¥å£ï¼Œæœ€åçš„æ‰§è¡Œè€…æ˜¯ç³»ç»Ÿï¼›åç¨‹çš„æ“ä½œåˆ™æ˜¯ç¨‹åºå‘˜ã€‚</p>
<p>åç¨‹å­˜åœ¨çš„æ„ä¹‰ï¼šå¯¹äºå¤šçº¿ç¨‹åº”ç”¨ï¼ŒCPUé€šè¿‡åˆ‡ç‰‡çš„æ–¹å¼æ¥åˆ‡æ¢çº¿ç¨‹é—´çš„æ‰§è¡Œï¼Œçº¿ç¨‹åˆ‡æ¢æ—¶éœ€è¦è€—æ—¶ï¼ˆä¿å­˜çŠ¶æ€ï¼Œä¸‹æ¬¡ç»§ç»­ï¼‰ã€‚åç¨‹ï¼Œåˆ™åªä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è§„å®šæŸä¸ªä»£ç å—æ‰§è¡Œé¡ºåºã€‚</p>
<p>åç¨‹çš„é€‚ç”¨åœºæ™¯ï¼šå½“ç¨‹åºä¸­å­˜åœ¨å¤§é‡ä¸éœ€è¦CPUçš„æ“ä½œæ—¶ï¼ˆIOï¼‰ï¼Œé€‚ç”¨äºåç¨‹ï¼›</p>
<p>event loopæ˜¯åç¨‹æ‰§è¡Œçš„æ§åˆ¶ç‚¹ï¼Œ å¦‚æœä½ å¸Œæœ›æ‰§è¡Œåç¨‹ï¼Œ å°±éœ€è¦ç”¨åˆ°å®ƒä»¬ã€‚</p>
<p><strong>event loopæä¾›äº†å¦‚ä¸‹çš„ç‰¹æ€§ï¼š</strong></p>
<p>æ³¨å†Œã€æ‰§è¡Œã€å–æ¶ˆå»¶æ—¶è°ƒç”¨(å¼‚æ­¥å‡½æ•°)</p>
<p>åˆ›å»ºç”¨äºé€šä¿¡çš„clientå’Œserveråè®®(å·¥å…·)</p>
<p>åˆ›å»ºå’Œåˆ«çš„ç¨‹åºé€šä¿¡çš„å­è¿›ç¨‹å’Œåè®®(å·¥å…·)</p>
<p>æŠŠå‡½æ•°è°ƒç”¨é€å…¥çº¿ç¨‹æ± ä¸­</p>
<p><strong>åç¨‹ç¤ºä¾‹ï¼š</strong></p>
<pre><code>import asyncio
   
async def cor1():
    print(&quot;COR1 start&quot;)
    await cor2()
    print(&quot;COR1 end&quot;)
   
async def cor2():
    print(&quot;COR2&quot;)
   
loop = asyncio.get_event_loop()
loop.run_until_complete(cor1())
loop.close()
</code></pre>
<p>æœ€åä¸‰è¡Œæ˜¯é‡ç‚¹ã€‚</p>
<p>asyncio.get_event_loop()  : asyncioå¯åŠ¨é»˜è®¤çš„event loop</p>
<p>run_until_complete()  :  è¿™ä¸ªå‡½æ•°æ˜¯é˜»å¡æ‰§è¡Œçš„ï¼ŒçŸ¥é“æ‰€æœ‰çš„å¼‚æ­¥å‡½æ•°æ‰§è¡Œå®Œæˆï¼Œ</p>
<p>close()  :  å…³é—­event loopã€‚</p>
<p><strong>1ã€greenlet</strong></p>
<pre><code>import greenlet
def fun1():
    print(&quot;12&quot;)
    gr2.switch()
    print(&quot;56&quot;)
    gr2.switch()
  
def fun2():
    print(&quot;34&quot;)
    gr1.switch()
    print(&quot;78&quot;)
  
  
gr1 = greenlet.greenlet(fun1)
gr2 = greenlet.greenlet(fun2)
gr1.switch()
</code></pre>
<p><strong>2ã€gevent</strong></p>
<p><strong>geventå±äºç¬¬ä¸‰æ–¹æ¨¡å—éœ€è¦ä¸‹è½½å®‰è£…åŒ…</strong></p>
<pre><code>pip3 install --upgrade pip3
pip3 install gevent


import gevent
  
def fun1():
    print(&quot;www.baidu.com&quot;)   # ç¬¬ä¸€æ­¥
    gevent.sleep(0)
    print(&quot;end the baidu.com&quot;)  # ç¬¬ä¸‰æ­¥
  
def fun2():
    print(&quot;www.zhihu.com&quot;)   # ç¬¬äºŒæ­¥
    gevent.sleep(0)
    print(&quot;end th zhihu.com&quot;)  # ç¬¬å››æ­¥
  
gevent.joinall([
    gevent.spawn(fun1),
    gevent.spawn(fun2),
])
</code></pre>
<p><strong>é‡åˆ°IOæ“ä½œè‡ªåŠ¨åˆ‡æ¢ï¼š</strong></p>
<pre><code>import gevent
import requests
def func(url):
    print(&quot;get: %s&quot;%url)
    gevent.sleep(0)
    date =requests.get(url)
    ret = date.text
    print(url,len(ret))
gevent.joinall([
    gevent.spawn(func, 'https://www.pythontab.com/'),
    gevent.spawn(func, 'https://www.yahoo.com/'),
    gevent.spawn(func, 'https://github.com/'),
])
</code></pre>
 </p>
                      </div>
                  </div>

                  <div class="row">
                      <div class="col-md-12 animate-box">
                          
                              <div class="next-post">
                                  <div class="next">ä¸‹ä¸€ç¯‡</div>
                                  <a href="https://yooinn.github.io//post/django-de-settings-zhong-she-zhi-zhong-wen-zhi-chi">
                                      <h3 class="post-title">
                                          djangoçš„settingsä¸­è®¾ç½®ä¸­æ–‡æ”¯æŒ
                                      </h3>
                                  </a>
                              </div>
                          
                      </div>
                  </div>

                  <div class="row">
                      <div class="col-md-12 animate-box">
                          
                              
                                  <div id="gitalk-container"></div>
                              

                              
                          
                      </div>
                  </div>
              </div>

          </article>
      </div>
  </div>

    
<footer id="fh5co-footer">
  <p>Powered by <a href="https://yooinn.github.io/" target="_blank">Jiank</a></p>
</footer>


    
<!-- jQuery -->
<script src="https://yooinn.github.io//media/scripts/vendors/jquery.min.js"></script>
<!-- jQuery Easing -->
<script src="https://yooinn.github.io//media/scripts/vendors/jquery.easing.1.3.js"></script>
<!-- Bootstrap -->
<script src="https://yooinn.github.io//media/scripts/vendors/bootstrap.min.js"></script>
<!-- Waypoints -->
<script src="https://yooinn.github.io//media/scripts/vendors/jquery.waypoints.min.js"></script>
<!-- Main JS -->
<script src="https://yooinn.github.io//media/scripts/vendors/main.js"></script>
<!-- Md5 Min JS -->
<script src="https://yooinn.github.io//media/scripts/vendors/md5.min.js"></script>

<script type="application/javascript">
    hljs.initHighlightingOnLoad();
</script>



    
        <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
        <script>

            var gitalk = new Gitalk({
                clientID: '18da3e757583aa6301c0',
                clientSecret: '49cea6508bf61d7606bce51766288ea312bd7456',
                repo: 'yooinn.github.io',
                owner: 'yooinn',
                admin: ['yooinn'],
                id: md5(location.pathname),      // Ensure uniqueness and length less than 50
                distractionFreeMode: false  // Facebook-like distraction free mode
            })

            gitalk.render('gitalk-container')

        </script>
    

    




  </body>
</html>
